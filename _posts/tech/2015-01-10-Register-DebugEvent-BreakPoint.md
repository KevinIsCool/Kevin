---
layout: post
title: Register、Debug Event and Breakpoint
category: tech
tags: 
- Register
- Debug Event 
- Breakpoint
excerpt: Harbin
---

##0x01 通用寄存器
在x86指令集中，一个CPU具有8个通用寄存器：EAX、EDX、ECX、ESI、EDI、EBP、ESP和EBX。除了这8个通用寄存器之外，CPU也存在其他寄存器。以上这8个通用寄存器都被安排了特定的用途，CPU在执行某些特定指令时需要特定的寄存器配合才能高效的完成其指令的执行过程。以下介绍各个寄存器的功能。

* * * *    
**EAX：**也被成为累加器（**A**ccumulate），用于协调一些常见的`运算操作`以及用于`传递函数调用的返回值`。在x86指令集中很多经过优化的指令会优先将数据写入或读出到EAX寄存器中，在对数据进行进一步操作。大多数基本的运算包括：加法、减法和比较运算。还有一些运算如乘法和除法则必须在EAX中运算。    
如上所述，EAX还用于保存函数调用的返回值，所以可以基于存储在EAX中的值来判断函数调用是否成功。除了布尔类型的返回值外，EAX也可以存储确切的函数返回值。
    
**EDX：**是一个数据寄存器（**D**ata），可以被认为是`EAX的延伸部分`，用于协作完成一些更为复杂的运算指令，如乘法和除法指令。EDX用于存放这些指令操作的额外数据结果。EDX也可用于通用目的的数据寄存器，但是其最常见的用法是和EAX联合完成这些复杂的运算。 
   
**ECX：**也被称为计数器（**C**ount），用于`支持循环操作`。典型的循环操作有存储一个字符串和计数。特别需要注意的一点是，ECX是反向计数的，而非正向计数。汇编代码中的计数都是按反向进行的。    

在x86汇编语言中，涉及数据处理的循环操作依赖于**ESI**和**EDI**这两个寄存器，以实现高效的数据操作。**ESI**寄存器也被称作`源变址寄存器`（**S**ource **I**ndex），这个寄存器存着输入数据流的位置信息。**EDI**寄存器则存放着指向相关数据操作结果的位置。称之为目的`变址寄存器`（**D**estination **I**ndex）。可以简记为ESI用于“读”，EDI用于“写”。在数据操作中使用源变址索引和目的变址索引可以极大的提高程序的运行效率。    

**EBP**和**ESP**寄存器分别被称为基址指针（**B**ase **P**oniter）和栈指针（**S**tack **P**ointer）。这些寄存器用于控制函数的调用和相关栈操作。当一个函数被调用时，调用参数连同函数的返回地址将先后被压入函数栈中。ESP始终指向栈顶，EBP则指向栈底。在某些情况下，编译器为了指令优化的目的可能会避免将EBP作为栈帧指针，在这些情况下，被“释放”出来的EBP可以像其他任何一个通用寄存器一样另作他用。    

**EBX**寄存器是唯一一个没有被指定特殊用途的寄存器。它可以用于额外的存储单元。    

另外一个应当提及的寄存器是**EIP**寄存器（**I**nstruction **P**ointer）。该寄存器始终指向当前正在被执行的指令。    

##0x02 调试事件
调试器内部其实是一个无限循环，这个循环每执行一次，调试器就会使自己陷入“阻塞”状态，以等待调试事件的发生。当一个调试事件发生时，调试器就会被激活，并调用相应的事件处理例程处理该事件。    
当处理例程被调用时，被调试的目标进程暂停执行并等待调试器做出如何继续的指示。一个调试器必须能够捕获以下几种常见的调试事件：    
>* 断点触发    
>* 非法内存操作（也被称为非法访问或者段违规）    
>* 由被调试程序抛出的异常    

每个操作系统都有自己独特的方式将这些调试事件分派给调试器，在这些操作系统中，除了以上给出的3种调试事件外，还存在着其他类型的调试事件，比如进程和线程的创建，或者一个动态链接库的运行时导入。    

可以由脚本驱动的调试器有一个很大的优势：**用户可以通过自定义事件处理例程来自动化执行某些调试任务**。例如，导致非法内存操作事件的一个极为常见的原因就是缓冲区溢出，在以往的调试过程中，一旦有非法内存访问，为了确认是否为缓冲区溢出，必须通过手动方式与调试器交互，来获得感兴趣的信息。而通过使用这些支持脚本集成的调试器，完全可以通过编写一个脚本来达到此目的。给予用户创建自定义的处理例程的能力不仅节约了大量的时间，而且能大大提高用户控制被调试进程的能力。    

##0x03 断点
通过设置断点可以使一个进程的执行暂停在一个符合某种特定条件的位置上。此时你可以对程序变量、栈上的参数以及分配的内存状态进行检查，并在目标进程对这些值做出任何改变之前将它们记录下来。一个调试器一般会提供三种最基本类型的断点：**1. 软断点 2. 硬件断点 3. 内存断点**。每种类型的断点都有着相似的行为，但是它们是通过不同的方式来实现的。    

####软断点
